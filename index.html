<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tabela Edit√°vel com Firebase (Tempo Real)</title>
  <style>
    :root{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;margin:0}
    body{padding:24px;background:#f6f8fb;color:#0f172a}
    .card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(14,20,30,0.06);padding:18px}
    h1{margin:0 0 14px;font-size:18px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left}
    th{background:#fbfdff}
    td[contenteditable]{min-width:80px}
    tr:hover{background:#fbfcff}
    button{padding:6px 10px;margin:2px;border-radius:6px;cursor:pointer}
    .btn-primary{background:#0b69ff;color:#fff;border:none}
    .btn-danger{background:#ff5b5b;color:#fff;border:none}
  </style>
</head>
<body>
  <div class="card">
    <h1>Tabela Edit√°vel (Firebase em tempo real)</h1>
    <div>
      <button id="addRow">‚ûï Adicionar Linha</button>
      <button id="saveFirebase" class="btn-primary">üíæ Salvar no Banco</button>
    </div>
    <br>
    <table id="table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone</th>
          <th>Observa√ß√µes</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Configura√ß√£o Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCaVDJ4LtJu-dlvSi4QrDygfhx1hBGSdDM",
      authDomain: "banco-de-dados-invest.firebaseapp.com",
      databaseURL: "https://banco-de-dados-invest-default-rtdb.firebaseio.com",
      projectId: "banco-de-dados-invest",
      storageBucket: "banco-de-dados-invest.firebasestorage.app",
      messagingSenderId: "5603892998",
      appId: "1:5603892998:web:459556f888d31629050887",
      measurementId: "G-JJWKMYXHTH"
    };

    // Inicializa√ß√£o
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tabelaRef = ref(db, "tabela");

    const tbody = document.querySelector("#table tbody");
    let rows = [];

    // Renderiza√ß√£o
    function render() {
      tbody.innerHTML = "";
      rows.forEach((r, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td contenteditable="true" data-key="nome">${r.nome || ""}</td>
          <td contenteditable="true" data-key="email">${r.email || ""}</td>
          <td contenteditable="true" data-key="telefone">${r.telefone || ""}</td>
          <td contenteditable="true" data-key="obs">${r.obs || ""}</td>
          <td><button class="btn-danger" data-index="${i}">Excluir</button></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Atualiza√ß√£o em tempo real (carrega automaticamente e atualiza se mudar no banco)
    onValue(tabelaRef, (snapshot) => {
      const data = snapshot.val();
      if (data) {
        rows = data;
        render();
      } else {
        rows = [];
        render();
      }
    });

    // Editar c√©lulas
    tbody.addEventListener("input", (e) => {
      const td = e.target;
      const key = td.dataset.key;
      const tr = td.closest("tr");
      const idx = [...tbody.children].indexOf(tr);
      rows[idx][key] = td.innerText.trim();
    });

    // Adicionar linha
    document.getElementById("addRow").addEventListener("click", () => {
      rows.push({ nome: "", email: "", telefone: "", obs: "" });
      render();
    });

    // Excluir linha
    tbody.addEventListener("click", (e) => {
      if (e.target.matches(".btn-danger")) {
        const idx = e.target.dataset.index;
        rows.splice(idx, 1);
        render();
      }
    });

    // Salvar manualmente
    document.getElementById("saveFirebase").addEventListener("click", async () => {
      try {
        await set(tabelaRef, rows);
        alert("‚úÖ Dados salvos com sucesso no Firebase!");
      } catch (err) {
        console.error(err);
        alert("‚ùå Erro ao salvar no Firebase (verifique regras ou permiss√µes).");
      }
    });
  </script>
</body>
</html>
